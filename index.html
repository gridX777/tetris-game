<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tetris with On-Screen Ads</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  height:100%;
  background:#0f172a;
  color:#e5e7eb;
  font-family:system-ui;
  overflow:hidden;
}

/* ===== LAYOUT ===== */
.wrap{
  display:flex;
  gap:12px;
  height:100%;
  padding:8px;
  box-sizing:border-box;
}

/* ===== GAME ===== */
canvas{
  background:#020617;
  border:3px solid #38bdf8;
}

#game{
  width:240px;
  height:480px;
}

/* ===== SIDE PANEL ===== */
.panel{
  display:flex;
  flex-direction:column;
  gap:6px;
}

h3{
  margin:0;
  text-align:center;
  font-size:14px;
}

.small{
  font-size:12px;
  text-align:center;
  opacity:.85;
}

/* ===== ADS ===== */
.ads-panel{
  width:320px;
  height:100%;
  border:3px solid #38bdf8;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.ads-panel h3{
  margin:6px 0;
}

#ad-frame{
  width:100%;
  height:100%;
  border:none;
  background:#000;
}
</style>
</head>

<body>
<div class="wrap">

  <!-- GAME -->
  <canvas id="game" width="120" height="240"></canvas>

  <!-- INFO -->
  <div class="panel">
    <h3>Next</h3>
    <canvas id="next" width="120" height="300"></canvas>

    <h3>Hold</h3>
    <canvas id="hold" width="90" height="90"></canvas>

    <div class="small" id="info"></div>
  </div>

  <!-- ADS -->
  <div class="ads-panel">
    <h3>Sponsored</h3>
    <iframe id="ad-frame" loading="lazy"></iframe>
  </div>

</div>

<script>
/* ================= CONFIG ================= */
const COLS=10, ROWS=20, SIZE=12;

/* ================= CANVAS ================= */
const game=document.getElementById('game');
const ctx=game.getContext('2d');
ctx.scale(SIZE,SIZE);

const next=document.getElementById('next').getContext('2d');
next.scale(15,15);

const holdC=document.getElementById('hold').getContext('2d');
holdC.scale(15,15);

const info=document.getElementById('info');

/* ================= ADS ================= */
const adFrame=document.getElementById('ad-frame');
const ADS=[
  "https://otieu.com/4/10341163",
  "https://otieu.com/4/10341164",
  "https://otieu.com/4/10341165",
  "https://otieu.com/4/10341171"
];

function rotateAd(){
  const url=ADS[Math.floor(Math.random()*ADS.length)];
  adFrame.src=url+"?t="+Date.now();
}
rotateAd();

/* ================= PIECES ================= */
const PIECES={
 I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],
 O:[[1,1],[1,1]],
 T:[[0,1,0],[1,1,1],[0,0,0]],
 S:[[0,1,1],[1,1,0],[0,0,0]],
 Z:[[1,1,0],[0,1,1],[0,0,0]],
 J:[[1,0,0],[1,1,1],[0,0,0]],
 L:[[0,0,1],[1,1,1],[0,0,0]]
};
const COLORS={
 I:'#22d3ee',O:'#fde047',T:'#a855f7',
 S:'#22c55e',Z:'#ef4444',J:'#3b82f6',L:'#f97316'
};

/* ================= STATE ================= */
const arena=Array.from({length:ROWS},()=>Array(COLS).fill(0));
let player,newPiece();
let score=0;

/* ================= HELPERS ================= */
function collide(p){
  return p.m.some((r,y)=>r.some((v,x)=>v && arena[y+p.y]?.[x+p.x]));
}
function drawM(m,o,c,t){
  m.forEach((r,y)=>r.forEach((v,x)=>{
    if(v){
      c.fillStyle=COLORS[t];
      c.fillRect(o.x+x,o.y+y,1,1);
    }
  }));
}

/* ================= GAME ================= */
function newPiece(){
  const keys=Object.keys(PIECES);
  const t=keys[Math.floor(Math.random()*keys.length)];
  player={t,m:PIECES[t].map(r=>r.slice()),x:3,y:0};
}
function merge(){
  player.m.forEach((r,y)=>r.forEach((v,x)=>{
    if(v) arena[y+player.y][x+player.x]=player.t;
  }));
}
function sweep(){
  for(let y=ROWS-1;y>=0;y--){
    if(arena[y].every(v=>v)){
      arena.splice(y,1);
      arena.unshift(Array(COLS).fill(0));
      score+=100;
      y++;
    }
  }
}
function drop(){
  player.y++;
  if(collide(player)){
    player.y--;
    merge();
    sweep();
    newPiece();
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.fillStyle='#020617';
  ctx.fillRect(0,0,COLS,ROWS);
  arena.forEach((r,y)=>r.forEach((v,x)=>v&&drawM([[1]],{x,y},ctx,v)));
  drawM(player.m,{x:player.x,y:player.y},ctx,player.t);
  info.textContent="Score: "+score;
}

/* ================= INPUT ================= */
document.addEventListener('keydown',e=>{
  const keys=['ArrowLeft','ArrowRight','ArrowDown',' ','z','x'];
  if(keys.includes(e.key)) rotateAd();

  if(e.key==='ArrowLeft'){player.x--;if(collide(player))player.x++;}
  if(e.key==='ArrowRight'){player.x++;if(collide(player))player.x--;}
  if(e.key==='ArrowDown') drop();
  if(e.key===' ') while(!collide({...player,y:player.y+1})) player.y++;
});

/* ================= LOOP ================= */
setInterval(()=>{drop();draw();},700);
</script>
</body>
</html>
